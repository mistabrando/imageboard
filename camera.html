<!DOCTYPE html>
<html>
  <head>
    <title>Capture Photo</title>
    <link href="bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script type="text/javascript" src="phonegap.js"></script>
    <script type="text/javascript" charset="utf-8">
    
    function onDeviceReady() {
      navigator.camera.getPicture(onSuccess, onFail, { 
        quality: 50 }); 
    }

    function onSuccess(imageData) {
      var image = document.getElementById('myImage');
      image.src = imageData;
      window.imageLocation = imageData;
    }

    function onFail(message) {
        alert('Failed because: ' + message);
    }

    function uploadPhoto(imageURI) {
        var options = new FileUploadOptions();
        options.fileKey="image";
        options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
        options.mimeType="image/jpeg";

        var ft = new FileTransfer();
        ft.upload(imageURI, encodeURI("http://imgbrd.aws.af.cm/uploadImage"), win, fail, options);
    }

    function win() {
      $("#submit").html("");
      $("#submit").append("<icon class = 'icon-smile icon-2x'></icon>");
      window.location.href = document.referrer;
    }

    function fail() {
      alert("Upload Failed");
      window.location.href = document.referrer;
    }

    $(function() {

      document.addEventListener("deviceready",onDeviceReady,false);
      
      $("#submit").bind("click", function(e){
        e.preventDefault();
        $("#submit").unbind("click");
        $("#submit").html("");
        $("#submit").append("<icon class = 'icon-cloud-upload icon-2x'></icon> Uploading ...");
        uploadPhoto(window.imageLocation);
        });
    });

    </script>
  </head>
  <body align = "center">
    <p class = "well">
      <textarea class="form-control" rows="3"></textarea>
      <div id = "imageInfo"></div>
      <img id = "myImage" width = "100%"></img>
    </p>
    <div class="row navbar-fixed-bottom" align = "center">
    <a class = "col-xs-12 btn btn-primary" id = "submit">
      <i class = 'icon-ok icon-2x'></i>
    </a>
  </div>
  </body>
</html>